<%- include('../partials/head.ejs', { title: 'articleadmin' }) %>

        body {
            background-color: #000000;
        }
        select option {
            background-color: white;
            color: black;
        }
        select option:hover {
            background-color: #DC2626;
            color: white;
        }
        .border-bottom-left-to-right {
            position: relative;
            border-radius: 0.75rem;
        }
        .border-bottom-left-to-right:hover::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background-color: #DC2626;
            animation: borderLeftToRight 0.3s ease-in-out forwards;
        }
        @keyframes borderLeftToRight {
            to {
                width: 100%;
            }
        }
        .icon-button {
            transition: transform 0.2s;
        }
        .icon-button:hover {
            transform: scale(1.1);
        }
        #mobile-menu-overlay {
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
            opacity: 0;
            width: 16rem;
            height: 100%;
            z-index: 1000;
            pointer-events: auto;
            will-change: transform, opacity;
        }
        .mobile-menu-open {
            transform: translateX(0);
            opacity: 1;
        }
        #mobile-menu-backdrop {
            display: none;
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            pointer-events: auto;
        }
        #mobile-menu-backdrop.active {
            display: block;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col text-white font-['Poppins']">
    
<%- include('../partials/navbar') %>

    <!-- Subnavbar -->
    <nav class="bg-gray-800 py-4">
        <div class="container mx-auto px-4 flex justify-center space-x-6">
            <a href="/admin/category" class="text-white text-lg font-semibold hover:text-red-600 transition">Category</a>
            <a href="/admin/brand" class="text-white text-lg font-semibold hover:text-red-600 transition">Brands</a>
            <a href="/admin/model" class="text-white text-lg font-semibold hover:text-red-600 transition">Model</a>
            <a href="/admin/article" class="text-white text-lg font-semibold hover:text-red-600 transition border-b-2 border-red-600">Article</a>
        </div>
    </nav>

    <!-- Main Section -->
    <main class="flex-grow container mx-auto px-4 py-8 max-w-screen-2xl bg-black">
        <!-- Upload Article Section -->
        <section class="mb-16">
            <h2 class="text-3xl font-bold text-white mb-6">Publish Article</h2>
            <form id="article-form" enctype="multipart/form-data" class="space-y-6 bg-gray-800 p-6 rounded-lg shadow-lg">
                <div>
                    <label for="article-title" class="block text-sm font-medium text-gray-300 mb-1">Upload the Title</label>
                    <input type="text" id="article-title" name="articleTitle" placeholder="Enter Article Title" required class="w-full px-4 py-2 bg-gray-700 border border-red-600 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 text-white">
                </div>
                <div>
                    <label for="main-image" class="block text-sm font-medium text-gray-300 mb-1">Main Image</label>
                    <input type="file" id="main-image" name="mainImage" accept="image/*" required class="w-full text-white bg-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-600 file:text-white hover:file:bg-red-700">
                </div>
                <!-- Content Icons -->
                <div class="border border-gray-600 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold text-white mb-4">Article Content</h3>
                    <div class="flex space-x-4 mb-4">
                        <button type="button" id="article-icon" class="icon-button bg-gray-700 p-2 rounded-full hover:bg-red-600 transition" title="Add Article">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                        </button>
                        <button type="button" id="photo-icon" class="icon-button bg-gray-700 p-2 rounded-full hover:bg-red-600 transition" title="Add Photo">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                        </button>
                        <button type="button" id="link-icon" class="icon-button bg-gray-700 p-2 rounded-full hover:bg-red-600 transition" title="Add Link">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" /></svg>
                        </button>
                        <button type="button" id="ads-icon" class="icon-button bg-gray-700 p-2 rounded-full hover:bg-red-600 transition" title="Add Ad">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.379c.4 0 .78.157 1.06.44" /></svg>
                        </button>
                        <button type="button" id="title-icon" class="icon-button bg-gray-700 p-2 rounded-full hover:bg-red-600 transition" title="Add Sub Title">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
                        </button>
                    </div>
                    <div id="content-area" class="relative"></div>
                </div>
                <!-- Region Selector -->
                <div>
                    <label for="region-selector" class="block text-sm font-medium text-gray-300 mb-1">Region</label>
                    <select id="region-selector" name="region" required class="w-full bg-gray-700 text-white text-lg font-semibold px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600">
                        <option value="" disabled selected>Select Region</option>
                        <option value="regional">Regional</option>
                        <option value="global">Global</option>
                    </select>
                </div>
                <button type="submit" id="publish-article-btn" class="w-full bg-red-600 text-white text-lg font-semibold px-6 py-2 rounded-lg shadow-lg hover:bg-red-700 transition">Publish Article</button>
            </form>
        </section>

        <!-- Already Published Articles -->
        <section>
            <h2 class="text-3xl font-bold text-white mb-6">Already Published Articles</h2>
            <div id="published-article-boxes" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Dynamically populated article boxes -->
            </div>
        </section>
    </main>

    <!-- Edit Article Modal -->
    <div id="edit-article-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
        <div class="bg-gray-800 rounded-lg p-6 w-full max-w-2xl">
            <h3 class="text-2xl font-bold text-white mb-4">Edit Article</h3>
            <form id="edit-article-form" enctype="multipart/form-data" class="space-y-6">
                <div>
                    <label for="edit-article-title" class="block text-sm font-medium text-gray-300 mb-1">Upload the Title</label>
                    <input type="text" id="edit-article-title" name="articleTitle" placeholder="Enter Article Title" required class="w-full px-4 py-2 bg-gray-700 border border-red-600 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 text-white">
                </div>
                <div>
                    <label for="edit-main-image" class="block text-sm font-medium text-gray-300 mb-1">Main Image</label>
                    <input type="file" id="edit-main-image" name="mainImage" accept="image/*" class="w-full text-white bg-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-600 file:text-white hover:file:bg-red-700">
                    <div id="edit-main-image-preview" class="mt-2"></div>
                </div>
                <div class="border border-gray-600 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold text-white mb-4">Article Content</h3>
                    <div class="flex space-x-4 mb-4">
                        <button type="button" id="edit-article-icon" class="icon-button bg-gray-700 p-2 rounded-full hover:bg-red-600 transition" title="Add Article">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                        </button>
                        <button type="button" id="edit-photo-icon" class="icon-button bg-gray-700 p-2 rounded-full hover:bg-red-600 transition" title="Add Photo">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                        </button>
                        <button type="button" id="edit-link-icon" class="icon-button bg-gray-700 p-2 rounded-full hover:bg-red-600 transition" title="Add Link">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" /></svg>
                        </button>
                        <button type="button" id="edit-ads-icon" class="icon-button bg-gray-700 p-2 rounded-full hover:bg-red-600 transition" title="Add Ad">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.379c.4 0 .78.157 1.06.44" /></svg>
                        </button>
                        <button type="button" id="edit-title-icon" class="icon-button bg-gray-700 p-2 rounded-full hover:bg-red-600 transition" title="Add Sub Title">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
                        </button>
                    </div>
                    <div id="edit-content-area" class="relative"></div>
                </div>
                <div>
                    <label for="edit-region-selector" class="block text-sm font-medium text-gray-300 mb-1">Region</label>
                    <select id="edit-region-selector" name="region" required class="w-full bg-gray-700 text-white text-lg font-semibold px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600">
                        <option value="" disabled selected>Select Region</option>
                        <option value="regional">Regional</option>
                        <option value="global">Global</option>
                    </select>
                </div>
                <div class="flex space-x-4">
                    <button type="submit" id="update-article-btn" class="w-full bg-red-600 text-white text-lg font-semibold px-6 py-2 rounded-lg shadow-lg hover:bg-red-700 transition">Update Article</button>
                    <button type="button" id="close-edit-modal" class="w-full bg-gray-600 text-white text-lg font-semibold px-6 py-2 rounded-lg shadow-lg hover:bg-gray-700 transition">Close</button>
                </div>
            </form>
        </div>
    </div>

    
<%- include('../partials/footer') %>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Mobile Menu Toggle
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
            const mobileMenuBackdrop = document.getElementById('mobile-menu-backdrop');
            const closeMobileMenuButton = document.getElementById('close-mobile-menu');

            const toggleMenu = () => {
                mobileMenuOverlay.classList.toggle('mobile-menu-open');
                mobileMenuBackdrop.classList.toggle('active');
            };

            mobileMenuButton.addEventListener('click', (e) => {
                e.preventDefault();
                toggleMenu();
            });

            closeMobileMenuButton.addEventListener('click', (e) => {
                e.preventDefault();
                mobileMenuOverlay.classList.remove('mobile-menu-open');
                mobileMenuBackdrop.classList.remove('active');
            });

            mobileMenuBackdrop.addEventListener('click', (e) => {
                e.preventDefault();
                mobileMenuOverlay.classList.remove('mobile-menu-open');
                mobileMenuBackdrop.classList.remove('active');
            });

            // Search Functionality
            document.getElementById('search-button').addEventListener('click', () => {
                const query = document.getElementById('search-input').value;
                if (query) {
                    alert('Search for: ' + query);
                } else {
                    alert('Please enter a search query.');
                }
            });

            // Highlight Active Nav Link
            const navLinks = document.querySelectorAll('#desktop-nav-links a, .mobile-nav-link');
            const currentPath = window.location.pathname;
            navLinks.forEach(link => {
                if (link.getAttribute('href') === currentPath) {
                    link.classList.add('bg-red-600', 'text-white');
                    link.classList.remove('hover:bg-red-600');
                }
            });

            // Article Content Icons
            let contentOrder = [], articleCount = 0, photoCount = 0, linkCount = 0, adCount = 0, titleCount = 0;
            const contentArea = document.getElementById('content-area');

            document.getElementById('article-icon').addEventListener('click', () => {
                const div = document.createElement('div');
                div.className = 'relative mb-4';
                div.id = `article-placeholder-${++articleCount}`;
                div.innerHTML = `
                    <textarea class="w-full px-4 py-2 bg-gray-700 border border-red-600 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 text-white" rows="6" placeholder="Enter Article Content"></textarea>
                    <button class="remove-content-btn absolute top-2 left-2 text-red-600 hover:text-red-700" title="Remove">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                `;
                contentArea.appendChild(div);
                contentOrder.push('article');
                div.querySelector('.remove-content-btn').addEventListener('click', () => {
                    div.remove();
                    contentOrder = contentOrder.filter((item, index) => item !== 'article' || index !== contentOrder.length - 1);
                });
            });

            document.getElementById('photo-icon').addEventListener('click', () => {
                const div = document.createElement('div');
                div.className = 'relative mb-4';
                div.id = `photo-placeholder-${++photoCount}`;
                div.innerHTML = `
                    <input type="file" accept="image/*" class="w-full text-white bg-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-600 file:text-white hover:file:bg-red-700">
                    <input type="text" class="w-full px-4 py-2 mt-2 bg-gray-700 border border-red-600 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 text-white" placeholder="Enter Image Source (e.g., forbes.com)">
                    <button class="remove-content-btn absolute top-2 left-2 text-red-600 hover:text-red-700" title="Remove">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                `;
                contentArea.appendChild(div);
                contentOrder.push('photo');
                div.querySelector('.remove-content-btn').addEventListener('click', () => {
                    div.remove();
                    contentOrder = contentOrder.filter((item, index) => item !== 'photo' || index !== contentOrder.length - 1);
                });
            });

            document.getElementById('link-icon').addEventListener('click', () => {
                const div = document.createElement('div');
                div.className = 'relative mb-4';
                div.id = `link-placeholder-${++linkCount}`;
                div.innerHTML = `
                    <input type="text" class="w-full px-4 py-2 bg-gray-700 border border-red-600 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 text-white" placeholder="Enter Link (e.g., youtube.com, forbes.com)">
                    <button class="remove-content-btn absolute top-2 left-2 text-red-600 hover:text-red-700" title="Remove">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                `;
                contentArea.appendChild(div);
                contentOrder.push('link');
                div.querySelector('.remove-content-btn').addEventListener('click', () => {
                    div.remove();
                    contentOrder = contentOrder.filter((item, index) => item !== 'link' || index !== contentOrder.length - 1);
                });
            });

            document.getElementById('ads-icon').addEventListener('click', () => {
                const div = document.createElement('div');
                div.className = 'relative mb-4';
                div.id = `ad-selector-${++adCount}`;
                div.innerHTML = `
                    <select class="w-full bg-gray-700 text-white text-lg font-semibold px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600">
                        <option value="" disabled selected>Select Ad Type</option>
                        <option value="banner-2:1">Banner Ad (2:1)</option>
                        <option value="square-1:1">Square Ad (1:1)</option>
                        <option value="skyscraper-1:3">Skyscraper Ad (1:3)</option>
                    </select>
                    <button class="remove-content-btn absolute top-2 left-2 text-red-600 hover:text-red-700" title="Remove">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                `;
                contentArea.appendChild(div);
                const adSelector = div.querySelector('select');
                adSelector.addEventListener('change', (e) => {
                    const [adName, adRatio] = e.target.value.split('-');
                    if (adName && adRatio) {
                        const adDiv = document.createElement('div');
                        adDiv.className = 'relative mb-4';
                        adDiv.id = `ad-placeholder-${adCount}`;
                        adDiv.innerHTML = `
                            <div class="w-full h-48 bg-gray-700 rounded-md flex items-center justify-center text-gray-400">${adName} (${adRatio})</div>
                            <button class="remove-content-btn absolute top-2 left-2 text-red-600 hover:text-red-700" title="Remove">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                            </button>
                        `;
                        contentArea.replaceChild(adDiv, div);
                        contentOrder.push('ad');
                        adDiv.querySelector('.remove-content-btn').addEventListener('click', () => {
                            adDiv.remove();
                            contentOrder = contentOrder.filter((item, index) => item !== 'ad' || index !== contentOrder.length - 1);
                        });
                    }
                });
                div.querySelector('.remove-content-btn').addEventListener('click', () => {
                    div.remove();
                    contentOrder = contentOrder.filter((item, index) => item !== 'ad' || index !== contentOrder.length - 1);
                });
            });

            document.getElementById('title-icon').addEventListener('click', () => {
                const div = document.createElement('div');
                div.className = 'relative mb-4';
                div.id = `title-placeholder-${++titleCount}`;
                div.innerHTML = `
                    <input type="text" class="w-full px-4 py-2 bg-gray-700 border border-red-600 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 text-white" placeholder="Enter Sub Title">
                    <button class="remove-content-btn absolute top-2 left-2 text-red-600 hover:text-red-700" title="Remove">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                `;
                contentArea.appendChild(div);
                contentOrder.push('title');
                div.querySelector('.remove-content-btn').addEventListener('click', () => {
                    div.remove();
                    contentOrder = contentOrder.filter((item, index) => item !== 'title' || index !== contentOrder.length - 1);
                });
            });

            // Publish Article
            const articleForm = document.getElementById('article-form');
            const publishedArticleBoxes = document.getElementById('published-article-boxes');
            let articles = [
                { id: 1, title: 'New Electric SUV Launched', image: 'suv.jpg', region: 'global', content: [], date: 'Oct 1, 2025' },
                { id: 2, title: 'Bike Technology Advancements', image: 'bike.jpg', region: 'regional', content: [], date: 'Oct 2, 2025' }
            ];

            articleForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const title = document.getElementById('article-title').value;
                const region = document.getElementById('region-selector').value;
                const mainImage = document.getElementById('main-image').files[0]?.name || 'default.jpg';
                const date = new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                const newArticle = {
                    id: articles.length + 1,
                    title,
                    image: mainImage,
                    region,
                    content: contentOrder,
                    date
                };
                articles.push(newArticle);
                renderArticles();
                articleForm.reset();
                contentArea.innerHTML = '';
                contentOrder = [];
                articleCount = photoCount = linkCount = adCount = titleCount = 0;
                alert(`Article "${title}" published as ${region}.`);
            });

            // Render Published Articles
            function renderArticles() {
                publishedArticleBoxes.innerHTML = '';
                articles.forEach(article => {
                    const box = document.createElement('div');
                    box.className = 'p-2 rounded-xl bg-gradient-to-b from-red-600 to-black shadow-lg border-bottom-left-to-right news-card';
                    box.innerHTML = `
                        <div class="flex flex-row items-center p-2 rounded-xl">
                            <div class="article-image w-32 h-32 bg-white rounded-lg flex-shrink-0">
                                <img src="/Uploads/articles/${article.image}" alt="${article.title}" class="w-full h-full object-contain rounded-lg">
                            </div>
                            <div class="content ml-4 flex-grow text-white">
                                <div class="article-title text-lg sm:text-2xl font-semibold mb-2">${article.title}</div>
                                <div class="date font-semibold">${article.date}</div>
                                <div class="text-gray-400 text-sm mt-2">Region: ${article.region}</div>
                            </div>
                        </div>
                        <div class="flex space-x-2 mt-4 justify-center">
                            <button class="edit-btn bg-blue-600 text-white px-4 py-1 rounded-lg hover:bg-blue-700 transition" data-id="${article.id}">Edit</button>
                            <button class="delete-btn bg-red-600 text-white px-4 py-1 rounded-lg hover:bg-red-700 transition" data-id="${article.id}" data-region="${article.region}">Delete</button>
                        </div>
                    `;
                    publishedArticleBoxes.appendChild(box);
                });
            }

            renderArticles();

            // Delete and Edit Functionality
            publishedArticleBoxes.addEventListener('click', (e) => {
                if (e.target.classList.contains('delete-btn')) {
                    const articleId = e.target.getAttribute('data-id');
                    const region = e.target.getAttribute('data-region');
                    const article = articles.find(a => a.id == articleId);
                    if (confirm(`Delete "${article.title}"${region === 'regional' ? ' from this region?' : ' globally from the database?'}`)) {
                        if (region === 'regional') {
                            alert(`"${article.title}" deleted from this region.`);
                        } else {
                            articles = articles.filter(a => a.id != articleId);
                            alert(`"${article.title}" deleted from database.`);
                        }
                        renderArticles();
                    }
                } else if (e.target.classList.contains('edit-btn')) {
                    const articleId = e.target.getAttribute('data-id');
                    const article = articles.find(a => a.id == articleId);
                    openEditModal(article);
                }
            });

            // Edit Article Modal
            const editModal = document.getElementById('edit-article-modal');
            const editContentArea = document.getElementById('edit-content-area');
            const closeEditModalBtn = document.getElementById('close-edit-modal');

            function openEditModal(article) {
                document.getElementById('edit-article-title').value = article.title;
                document.getElementById('edit-region-selector').value = article.region;
                document.getElementById('edit-main-image-preview').innerHTML = `<img src="/Uploads/articles/${article.image}" alt="${article.title}" class="w-32 h-32 object-contain rounded-lg">`;
                editContentArea.innerHTML = '';
                contentOrder = [...article.content];
                articleCount = photoCount = linkCount = adCount = titleCount = 0;

                article.content.forEach(type => {
                    if (type === 'article') {
                        const div = document.createElement('div');
                        div.className = 'relative mb-4';
                        div.id = `edit-article-placeholder-${++articleCount}`;
                        div.innerHTML = `
                            <textarea class="w-full px-4 py-2 bg-gray-700 border border-red-600 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 text-white" rows="6" placeholder="Enter Article Content"></textarea>
                            <button class="remove-content-btn absolute top-2 left-2 text-red-600 hover:text-red-700" title="Remove">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                            </button>
                        `;
                        editContentArea.appendChild(div);
                        div.querySelector('.remove-content-btn').addEventListener('click', () => {
                            div.remove();
                            contentOrder = contentOrder.filter((item, index) => item !== 'article' || index !== contentOrder.length - 1);
                        });
                    } else if (type === 'photo') {
                        const div = document.createElement('div');
                        div.className = 'relative mb-4';
                        div.id = `edit-photo-placeholder-${++photoCount}`;
                        div.innerHTML = `
                            <input type="file" accept="image/*" class="w-full text-white bg-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-600 file:text-white hover:file:bg-red-700">
                            <input type="text" class="w-full px-4 py-2 mt-2 bg-gray-700 border border-red-600 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 text-white" placeholder="Enter Image Source (e.g., forbes.com)">
                            <button class="remove-content-btn absolute top-2 left-2 text-red-600 hover:text-red-700" title="Remove">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                            </button>
                        `;
                        editContentArea.appendChild(div);
                        div.querySelector('.remove-content-btn').addEventListener('click', () => {
                            div.remove();
                            contentOrder = contentOrder.filter((item, index) => item !== 'photo' || index !== contentOrder.length - 1);
                        });
                    } else if (type === 'link') {
                        const div = document.createElement('div');
                        div.className = 'relative mb-4';
                        div.id = `edit-link-placeholder-${++linkCount}`;
                        div.innerHTML = `
                            <input type="text" class="w-full px-4 py-2 bg-gray-700 border border-red-600 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 text-white" placeholder="Enter Link (e.g., youtube.com, forbes.com)">
                            <button class="remove-content-btn absolute top-2 left-2 text-red-600 hover:text-red-700" title="Remove">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                            </button>
                        `;
                        editContentArea.appendChild(div);
                        div.querySelector('.remove-content-btn').addEventListener('click', () => {
                            div.remove();
                            contentOrder = contentOrder.filter((item, index) => item !== 'link' || index !== contentOrder.length - 1);
                        });
                    } else if (type === 'ad') {
                        const div = document.createElement('div');
                        div.className = 'relative mb-4';
                        div.id = `edit-ad-selector-${++adCount}`;
                        div.innerHTML = `
                            <select class="w-full bg-gray-700 text-white text-lg font-semibold px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600">
                                <option value="" disabled selected>Select Ad Type</option>
                                <option value="banner-2:1">Banner Ad (2:1)</option>
                                <option value="square-1:1">Square Ad (1:1)</option>
                                <option value="skyscraper-1:3">Skyscraper Ad (1:3)</option>
                            </select>
                            <button class="remove-content-btn absolute top-2 left-2 text-red-600 hover:text-red-700" title="Remove">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                            </button>
                        `;
                        editContentArea.appendChild(div);
                        const adSelector = div.querySelector('select');
                        adSelector.addEventListener('change', (e) => {
                            const [adName, adRatio] = e.target.value.split('-');
                            if (adName && adRatio) {
                                const adDiv = document.createElement('div');
                                adDiv.className = 'relative mb-4';
                                adDiv.id = `edit-ad-placeholder-${adCount}`;
                                adDiv.innerHTML = `
                                    <div class="w-full h-48 bg-gray-700 rounded-md flex items-center justify-center text-gray-400">${adName} (${adRatio})</div>
                                    <button class="remove-content-btn absolute top-2 left-2 text-red-600 hover:text-red-700" title="Remove">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                                    </button>
                                `;
                                editContentArea.replaceChild(adDiv, div);
                                contentOrder.push('ad');
                                adDiv.querySelector('.remove-content-btn').addEventListener('click', () => {
                                    adDiv.remove();
                                    contentOrder = contentOrder.filter((item, index) => item !== 'ad' || index !== contentOrder.length - 1);
                                });
                            }
                        });
                        div.querySelector('.remove-content-btn').addEventListener('click', () => {
                            div.remove();
                            contentOrder = contentOrder.filter((item, index) => item !== 'ad' || index !== contentOrder.length - 1);
                        });
                    } else if (type === 'title') {
                        const div = document.createElement('div');
                        div.className = 'relative mb-4';
                        div.id = `edit-title-placeholder-${++titleCount}`;
                        div.innerHTML = `
                            <input type="text" class="w-full px-4 py-2 bg-gray-700 border border-red-600 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 text-white" placeholder="Enter Sub Title">
                            <button class="remove-content-btn absolute top-2 left-2 text-red-600 hover:text-red-700" title="Remove">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                            </button>
                        `;
                        editContentArea.appendChild(div);
                        div.querySelector('.remove-content-btn').addEventListener('click', () => {
                            div.remove();
                            contentOrder = contentOrder.filter((item, index) => item !== 'title' || index !== contentOrder.length - 1);
                        });
                    }
                });

                editModal.classList.remove('hidden');
                editModal.setAttribute('data-id', article.id);
            }

            // Edit Content Icons
            document.getElementById('edit-article-icon').addEventListener('click', () => {
                const div = document.createElement('div');
                div.className = 'relative mb-4';
                div.id = `edit-article-placeholder-${++articleCount}`;
                div.innerHTML = `
                    <textarea class="w-full px-4 py-2 bg-gray-700 border border-red-600 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 text-white" rows="6" placeholder="Enter Article Content"></textarea>
                    <button class="remove-content-btn absolute top-2 left-2 text-red-600 hover:text-red-700" title="Remove">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                `;
                editContentArea.appendChild(div);
                contentOrder.push('article');
                div.querySelector('.remove-content-btn').addEventListener('click', () => {
                    div.remove();
                    contentOrder = contentOrder.filter((item, index) => item !== 'article' || index !== contentOrder.length - 1);
                });
            });

            document.getElementById('edit-photo-icon').addEventListener('click', () => {
                const div = document.createElement('div');
                div.className = 'relative mb-4';
                div.id = `edit-photo-placeholder-${++photoCount}`;
                div.innerHTML = `
                    <input type="file" accept="image/*" class="w-full text-white bg-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-600 file:text-white hover:file:bg-red-700">
                    <input type="text" class="w-full px-4 py-2 mt-2 bg-gray-700 border border-red-600 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 text-white" placeholder="Enter Image Source (e.g., forbes.com)">
                    <button class="remove-content-btn absolute top-2 left-2 text-red-600 hover:text-red-700" title="Remove">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                `;
                editContentArea.appendChild(div);
                contentOrder.push('photo');
                div.querySelector('.remove-content-btn').addEventListener('click', () => {
                    div.remove();
                    contentOrder = contentOrder.filter((item, index) => item !== 'photo' || index !== contentOrder.length - 1);
                });
            });

            document.getElementById('edit-link-icon').addEventListener('click', () => {
                const div = document.createElement('div');
                div.className = 'relative mb-4';
                div.id = `edit-link-placeholder-${++linkCount}`;
                div.innerHTML = `
                    <input type="text" class="w-full px-4 py-2 bg-gray-700 border border-red-600 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 text-white" placeholder="Enter Link (e.g., youtube.com, forbes.com)">
                    <button class="remove-content-btn absolute top-2 left-2 text-red-600 hover:text-red-700" title="Remove">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                `;
                editContentArea.appendChild(div);
                contentOrder.push('link');
                div.querySelector('.remove-content-btn').addEventListener('click', () => {
                    div.remove();
                    contentOrder = contentOrder.filter((item, index) => item !== 'link' || index !== contentOrder.length - 1);
                });
            });

            document.getElementById('edit-ads-icon').addEventListener('click', () => {
                const div = document.createElement('div');
                div.className = 'relative mb-4';
                div.id = `edit-ad-selector-${++adCount}`;
                div.innerHTML = `
                    <select class="w-full bg-gray-700 text-white text-lg font-semibold px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600">
                        <option value="" disabled selected>Select Ad Type</option>
                        <option value="banner-2:1">Banner Ad (2:1)</option>
                        <option value="square-1:1">Square Ad (1:1)</option>
                        <option value="skyscraper-1:3">Skyscraper Ad (1:3)</option>
                    </select>
                    <button class="remove-content-btn absolute top-2 left-2 text-red-600 hover:text-red-700" title="Remove">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                `;
                editContentArea.appendChild(div);
                const adSelector = div.querySelector('select');
                adSelector.addEventListener('change', (e) => {
                    const [adName, adRatio] = e.target.value.split('-');
                    if (adName && adRatio) {
                        const adDiv = document.createElement('div');
                        adDiv.className = 'relative mb-4';
                        adDiv.id = `edit-ad-placeholder-${adCount}`;
                        adDiv.innerHTML = `
                            <div class="w-full h-48 bg-gray-700 rounded-md flex items-center justify-center text-gray-400">${adName} (${adRatio})</div>
                            <button class="remove-content-btn absolute top-2 left-2 text-red-600 hover:text-red-700" title="Remove">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                            </button>
                        `;
                        editContentArea.replaceChild(adDiv, div);
                        contentOrder.push('ad');
                        adDiv.querySelector('.remove-content-btn').addEventListener('click', () => {
                            adDiv.remove();
                            contentOrder = contentOrder.filter((item, index) => item !== 'ad' || index !== contentOrder.length - 1);
                        });
                    }
                });
                div.querySelector('.remove-content-btn').addEventListener('click', () => {
                    div.remove();
                    contentOrder = contentOrder.filter((item, index) => item !== 'ad' || index !== contentOrder.length - 1);
                });
            });

            document.getElementById('edit-title-icon').addEventListener('click', () => {
                const div = document.createElement('div');
                div.className = 'relative mb-4';
                div.id = `edit-title-placeholder-${++titleCount}`;
                div.innerHTML = `
                    <input type="text" class="w-full px-4 py-2 bg-gray-700 border border-red-600 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 text-white" placeholder="Enter Sub Title">
                    <button class="remove-content-btn absolute top-2 left-2 text-red-600 hover:text-red-700" title="Remove">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                `;
                editContentArea.appendChild(div);
                contentOrder.push('title');
                div.querySelector('.remove-content-btn').addEventListener('click', () => {
                    div.remove();
                    contentOrder = contentOrder.filter((item, index) => item !== 'title' || index !== contentOrder.length - 1);
                });
            });

            // Update Article
            const editArticleForm = document.getElementById('edit-article-form');
            editArticleForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const articleId = editModal.getAttribute('data-id');
                const title = document.getElementById('edit-article-title').value;
                const region = document.getElementById('edit-region-selector').value;
                const mainImage = document.getElementById('edit-main-image').files[0]?.name || articles.find(a => a.id == articleId).image;
                const date = new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });

                articles = articles.map(article => {
                    if (article.id == articleId) {
                        return {
                            ...article,
                            title,
                            image: mainImage,
                            region,
                            content: contentOrder,
                            date
                        };
                    }
                    return article;
                });

                renderArticles();
                editModal.classList.add('hidden');
                editContentArea.innerHTML = '';
                contentOrder = [];
                articleCount = photoCount = linkCount = adCount = titleCount = 0;
                alert(`Article "${title}" updated successfully.`);
            });

            // Close Edit Modal
            closeEditModalBtn.addEventListener('click', () => {
                editModal.classList.add('hidden');
                editContentArea.innerHTML = '';
                contentOrder = [];
                articleCount = photoCount = linkCount = adCount = titleCount = 0;
            });

            // Close modal when clicking outside
            editModal.addEventListener('click', (e) => {
                if (e.target === editModal) {
                    editModal.classList.add('hidden');
                    editContentArea.innerHTML = '';
                    contentOrder = [];
                    articleCount = photoCount = linkCount = adCount = titleCount = 0;
                }
            });
        });
    </script>
</body>
</html>