<%- include('../partials/head.ejs', { 
    title: `${category.name} ${category.vehicle_type_name}s in USA | Electric, ICE, Hybrid Models | Gyarage`,
    description: `All latest ${category.name} ${category.vehicle_type_name}s in USA - Electric, Petrol, Diesel, Hybrid with price and specs.`,
    keywords: `${category.name}, ${category.name} USA, ${category.name} electric, ${category.name} hybrid, ${category.vehicle_type_name}`,
    canonical: `/categorydetails/${category.category_id}`
}) %>

<style>
    /* Premium Red Filter - EXACT SAME AS BRANDSDETAILS */
    .premium-filter-container { z-index: 10; }

    #engineFilter {
        background: linear-gradient(135deg, #DC2626, #B91C1C);
        border: 2px solid #EF4444;
        color: white;
        padding: 14px 44px 14px 24px;
        border-radius: 50px;
        font-size: 16px;
        font-weight: 600;
        min-width: 260px;
        cursor: pointer;
        box-shadow: 
            inset 0 6px 20px rgba(220, 38, 38, 0.4),
            inset 0 2px 8px rgba(255, 255, 255, 0.2);
        transition: all 0.35s ease;
        appearance: none;
        font-family: 'Poppins', sans-serif;

        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 18px center;
        background-size: 16px;
    }

    #engineFilter:hover {
        background: linear-gradient(135deg, #EF4444, #DC2626);
        transform: translateY(-3px);
        box-shadow: 0 14px 35px rgba(220, 38, 38, 0.6);
    }

    #engineFilter:focus {
        outline: none;
        box-shadow: 0 0 0 5px rgba(220, 38, 38, 0.4), 0 14px 35px rgba(220, 38, 38, 0.6);
    }

    #engineFilter option {
        background: #111;
        color: white;
        padding: 12px 20px;
        font-weight: 500;
    }

    #engineFilter option:checked {
        background: #DC2626;
        color: white;
    }

    @media (min-width: 769px) {
        .premium-filter-container {
            position: absolute;
            bottom: -70px;
            right: 0;
        }
    }

    @media (max-width: 768px) {
        .premium-filter-container {
            position: static;
            margin-top: 3rem;
            display: flex;
            justify-content: center;
        }
        #engineFilter {
            min-width: 100%;
            max-width: 380px;
            padding: 14px 44px 14px 20px;
            background-position: right 16px center;
        }
    }
</style>
</head>

<body class="min-h-screen flex flex-col text-white font-['Poppins'] bg-black">
    <%- include('../partials/navbar') %>

    <main class="flex-grow container mx-auto px-6 py-16 max-w-screen-2xl">

        <!-- Title + Premium Filter -->
        <div class="relative mb-44">
            <h1 id="pageTitle" class="text-4xl md:text-6xl font-bold text-white text-center leading-tight">
                All <%= category.name %> <%= category.vehicle_type_name %>s in USA
            </h1>

            <div class="premium-filter-container">
                <select id="engineFilter">
                    <option value="all">All Models</option>
                    <option value="electric">Electric Only</option>
                    <option value="ice">ICE (Petrol/Diesel)</option>
                    <option value="hybrid">Hybrid</option>
                    <option value="phev">Plug-in Hybrid (PHEV)</option>
                </select>
            </div>
        </div>

        <h1 class="sr-only" id="seoTitle">All <%= category.name %> <%= category.vehicle_type_name %>s in USA - Latest Price & Specs</h1>

        <div id="modelsContainer" class="mt-5">

            <!-- Electric Models -->
            <% if (electricModels?.length > 0) { %>
                <div class="engine-section" data-engine="electric">
                    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6">
                        <% electricModels.forEach(model => { %>
                            <a href="/modeldetails/<%= model.id %>" class="block group">
                                <div class="bg-gradient-to-b from-red-600 to-black rounded-xl overflow-hidden shadow-xl transition-all duration-300 hover:scale-105 hover:shadow-2xl">
                                    <% if (model.model_image) { %>
                                        <img src="<%= model.model_image %>" alt="<%= model.model_name %> <%= category.name %>" class="w-full h-40 object-cover">
                                    <% } else { %>
                                        <div class="w-full h-40 bg-gray-800 border border-gray-700"></div>
                                    <% } %>
                                    <div class="p-5 text-center">
                                        <h3 class="font-bold text-lg"><%= model.model_name %></h3>
                                        <% if (model.brand_name) { %>
                                            <p class="text-gray-400 text-sm"><%= model.brand_name %></p>
                                        <% } %>
                                        <p class="text-red-400 font-bold text-xl mt-2">
                                            <%= model.starting_price ? '$' + Number(model.starting_price).toLocaleString() : 'Price TBA' %>
                                        </p>
                                        <button class="mt-4 px-6 py-2 bg-white text-black rounded-full text-sm font-bold hover:bg-red-600 hover:text-white transition">
                                            Check out
                                        </button>
                                    </div>
                                </div>
                            </a>
                        <% }) %>
                    </div>
                </div>
            <% } %>

            <!-- ICE Models -->
            <% if (iceModels?.length > 0) { %>
                <div class="engine-section" data-engine="ice">
                    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6">
                        <% iceModels.forEach(model => { %>
                            <a href="/modeldetails/<%= model.id %>" class="block group">
                                <div class="bg-gradient-to-b from-red-600 to-black rounded-xl overflow-hidden shadow-xl transition-all duration-300 hover:scale-105 hover:shadow-2xl">
                                    <% if (model.model_image) { %>
                                        <img src="<%= model.model_image %>" alt="<%= model.model_name %> <%= category.name %>" class="w-full h-40 object-cover">
                                    <% } else { %>
                                        <div class="w-full h-40 bg-gray-800 border border-gray-700"></div>
                                    <% } %>
                                    <div class="p-5 text-center">
                                        <h3 class="font-bold text-lg"><%= model.model_name %></h3>
                                        <% if (model.brand_name) { %>
                                            <p class="text-gray-400 text-sm"><%= model.brand_name %></p>
                                        <% } %>
                                        <p class="text-red-400 font-bold text-xl mt-2">
                                            <%= model.starting_price ? '$' + Number(model.starting_price).toLocaleString() : 'Price TBA' %>
                                        </p>
                                        <button class="mt-4 px-6 py-2 bg-white text-black rounded-full text-sm font-bold hover:bg-red-600 hover:text-white transition">
                                            Check out
                                        </button>
                                    </div>
                                </div>
                            </a>
                        <% }) %>
                    </div>
                </div>
            <% } %>

            <!-- Hybrid Models -->
            <% if (hybridModels?.length > 0) { %>
                <div class="engine-section" data-engine="hybrid">
                    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6">
                        <% hybridModels.forEach(model => { %>
                            <a href="/modeldetails/<%= model.id %>" class="block group">
                                <div class="bg-gradient-to-b from-red-600 to-black rounded-xl overflow-hidden shadow-xl transition-all duration-300 hover:scale-105 hover:shadow-2xl">
                                    <% if (model.model_image) { %>
                                        <img src="<%= model.model_image %>" alt="<%= model.model_name %> <%= category.name %>" class="w-full h-40 object-cover">
                                    <% } else { %>
                                        <div class="w-full h-40 bg-gray-800 border border-gray-700"></div>
                                    <% } %>
                                    <div class="p-5 text-center">
                                        <h3 class="font-bold text-lg"><%= model.model_name %></h3>
                                        <% if (model.brand_name) { %>
                                            <p class="text-gray-400 text-sm"><%= model.brand_name %></p>
                                        <% } %>
                                        <p class="text-red-400 font-bold text-xl mt-2">
                                            <%= model.starting_price ? '$' + Number(model.starting_price).toLocaleString() : 'Price TBA' %>
                                        </p>
                                        <button class="mt-4 px-6 py-2 bg-white text-black rounded-full text-sm font-bold hover:bg-red-600 hover:text-white transition">
                                            Check out
                                        </button>
                                    </div>
                                </div>
                            </a>
                        <% }) %>
                    </div>
                </div>
            <% } %>

            <!-- PHEV Models -->
            <% if (phevModels?.length > 0) { %>
                <div class="engine-section" data-engine="phev">
                    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6">
                        <% phevModels.forEach(model => { %>
                            <a href="/modeldetails/<%= model.id %>" class="block group">
                                <div class="bg-gradient-to-b from-red-600 to-black rounded-xl overflow-hidden shadow-xl transition-all duration-300 hover:scale-105 hover:shadow-2xl">
                                    <% if (model.model_image) { %>
                                        <img src="<%= model.model_image %>" alt="<%= model.model_name %> <%= category.name %>" class="w-full h-40 object-cover">
                                    <% } else { %>
                                        <div class="w-full h-40 bg-gray-800 border border-gray-700"></div>
                                    <% } %>
                                    <div class="p-5 text-center">
                                        <h3 class="font-bold text-lg"><%= model.model_name %></h3>
                                        <% if (model.brand_name) { %>
                                            <p class="text-gray-400 text-sm"><%= model.brand_name %></p>
                                        <% } %>
                                        <p class="text-red-400 font-bold text-xl mt-2">
                                            <%= model.starting_price ? '$' + Number(model.starting_price).toLocaleString() : 'Price TBA' %>
                                        </p>
                                        <button class="mt-4 px-6 py-2 bg-white text-black rounded-full text-sm font-bold hover:bg-red-600 hover:text-white transition">
                                            Check out
                                        </button>
                                    </div>
                                </div>
                            </a>
                        <% }) %>
                    </div>
                </div>
            <% } %>

        </div>

        <!-- No Results - EXACT SAME AS BRANDSDETAILS -->
        <div id="noResults" class="text-center py-32 hidden">
            <p class="text-4xl font-bold text-gray-500">No models found for selected filter</p>
        </div>

    </main>

    <%- include('../partials/footer') %>

    <!-- Perfect Working Filter Script -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const filter = document.getElementById('engineFilter');
            const pageTitle = document.getElementById('pageTitle');
            const seoTitle = document.getElementById('seoTitle');
            const sections = document.querySelectorAll('.engine-section');
            const noResults = document.getElementById('noResults');

            const catName = "<%= category.name %>";
            const typeName = "<%= category.vehicle_type_name %>s";

            const titles = {
                all: `All ${catName} ${typeName} in USA`,
                electric: `${catName} Electric ${typeName} in USA`,
                ice: `${catName} ICE ${typeName} in USA`,
                hybrid: `${catName} Hybrid ${typeName} in USA`,
                phev: `${catName} Plug-in Hybrid ${typeName} in USA`
            };

            function updateView() {
                const val = filter.value;
                let hasVisible = false;

                sections.forEach(sec => {
                    const show = val === 'all' || sec.dataset.engine === val;
                    sec.style.display = show ? 'block' : 'none';
                    if (show && sec.querySelector('a')) hasVisible = true;
                });

                pageTitle.textContent = titles[val] || titles.all;
                seoTitle.textContent = (titles[val] || titles.all) + " - Latest Price & Specs";
                noResults.classList.toggle('hidden', val === 'all' || hasVisible);
            }

            filter.addEventListener('change', updateView);
            updateView();
        });
    </script>
</body>
</html>